---
  #- include: font.yml
#  - include: base16.yml
- name: Include User Variables
  include_vars: users.yml


- name: Create groups before users
  group:
    name: "{{ item }}"
    state: present
  with_items:
    - "{{base_groups}}"


- name: Create Public User
  user:
    state: present
    comment: "Public User"
    name: public
    createhome: yes
    password: "$6$7aUMFzunHBz6eN$YFpmYsvxK.hjtDHxf6cwY9Fe.ujGijvla04gxxKdVDwrrN6pOkKTh3isBsxcAU1MqoZ6Kk3rzJuLBwGtZDX1H."
#    groups: public,adm,cdrom,dip,plugdev,sambashare,libvirtd

- name: Create IT User
  user:
    comment: "IT User"
    state: present
    name: it
    createhome: yes
#    groups: public,adm,cdrom,dip,plugdev,sambashare,libvirtd,sudo

- name: Create Remote
  user:
    comment: "Remote"
    state: present
    name: remote
    createhome: yes
#    groups: public,adm,cdrom,dip,plugdev,sambashare,libvirtd,sudo

- name: Deploy keys
  authorized_key:
    user: it
    key: "{{ lookup('file', '/home/joe/.ssh/remote.pub') }}"
    path: '/etc/ssh/authorized_keys/it'

# - include: "all_gconf.yml"

- name: Autologin Public Create Directory
  file:
    path: "/etc/lightdm/lightdm.conf.d/"
    state: directory
    mode: 0755

- name: Autologin Public User file
  copy:
    src: "files/autologinpublic.conf"
    dest: "/etc/lightdm/lightdm.conf.d/"
    mode: 0755

- name: Copy bashrc file
  copy:
    src: 'files/bashrc'
    dest: "/home/{{ item }}/.bashrc"
    mode: 0644
    group: "{{ item }}"
    owner: "{{ item }}"
  with_items:
    - "{{ simple_users }}"

- name: Rem errant bashrc
  file:
    path: "/home/{{ item }}/bashrc"
    state: absent
  with_items:
    - "{{ simple_users }}"


- name: Setup wallpaper Rotation Service systemd folder
  file:
    path: "/home/{{ item }}/.conf/systemd/user"
    state: directory
  with_items:
    - "{{ simple_users }}"




- name: systemd files (1/2)
  copy:
    src: 'files/services/gnome-background-change.service'
    dest: "/home/{{ item }}/.conf/systemd/user"
    mode: 0644
    group: "{{ item }}"
    owner: "{{ item }}"
  with_items:
    - "{{ simple_users }}"


- name: systemd files (2/2)
  copy:
    src: 'files/services/gnome-background-change.timer'
    dest: "/home/{{ item }}/.conf/systemd/user"
    mode: 0644
    group: "{{ item }}"
    owner: "{{ item }}"
  with_items:
    - "{{ simple_users }}"

- name: Create Directory for wallpapers
  file:
    path: "/opt/provision/wallpaper/"
    state: directory
    mode: 0755

- name: Create Directory for wallpapers users
  file:
    path: "/opt/provision/wallpaper/{{ item }}/"
    state: directory
    mode: 0755
  with_items:
    - "{{ simple_users }}"



  # Example action to enable service httpd and ensure it is not masked
  - name: Enable wallpaper changing service
    systemd:
      name: gnome-background-change.timer
      enabled: yes
      state: started


- name: Copy Wallpapers
  copy:
    src: "files/wallpaper/{{ item }}.jpg"
    dest: "/opt/provision/wallpaper/{{ item }}/wallpaper1.jpg"
    mode: 0644
  with_items:
    - "{{ simple_users }}"


- name: Autologin Public Create Directory
  file:
    path: "/etc/lightdm/lightdm.conf.d/"
    state: directory
    mode: 0755

- name: Autologin Public User file
  copy:
    src: "files/autologinpublic.conf"
    dest: "/etc/lightdm/lightdm.conf.d/"
    mode: 0755

- name: Copy update script and make it executable
  copy: src=files/autoupdate.sh dest=/etc/cron.daily owner=root group=root mode=755 backup=yes
